--McLaren Points Per Season, Win/Loss
WITH ConstructorPoints AS (
    SELECT 
        R.YEAR,
        C.NAME AS CONSTRUCTOR_NAME,
        SUM(CONVERT(decimal, RE.POINTS)) AS TOTAL_POINTS
    FROM RESULTS RE
    JOIN RACES R ON RE.RACEID = R.RACEID
    JOIN CONSTRUCTORS C ON RE.CONSTRUCTORID = C.CONSTRUCTORID
    GROUP BY R.YEAR, C.NAME
),
MaxPointsPerYear AS (
    SELECT 
        YEAR,
        MAX(TOTAL_POINTS) AS MAX_POINTS
    FROM ConstructorPoints
    GROUP BY YEAR
)
SELECT 
    CP.YEAR,
    CP.TOTAL_POINTS,
    (SELECT COUNT(*) FROM RACES R2 WHERE R2.YEAR = CP.YEAR) AS NUMBER_OF_RACES,
    CASE 
        WHEN CP.TOTAL_POINTS = MP.MAX_POINTS THEN 'Won'
        ELSE 'Lost'
    END AS RESULT
FROM ConstructorPoints CP
JOIN MaxPointsPerYear MP ON CP.YEAR = MP.YEAR
WHERE CP.CONSTRUCTOR_NAME = 'McLaren'
ORDER BY CP.YEAR;
